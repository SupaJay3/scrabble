<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Anagram Game</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: Comfortaa, sans-serif;
    background: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    background: white;
    padding: 20px;
    border-radius: 12px;
    width: 420px;
    text-align: center;
}

button {
    font-family: Comfortaa, sans-serif;
    padding: 6px 10px;
    margin: 4px;
    cursor: pointer;
}

.difficulty {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    margin-top: 12px;
}

small {
    display: block;
    font-size: 11px;
    opacity: 0.6;
}
</style>
</head>

<body>
<div class="container">

<h2 id="prompt">Loadingâ€¦</h2>

<input id="guess" placeholder="Your guess">
<br><br>

<button onclick="submitGuess()">Submit</button>
<button onclick="giveUp()">Give up</button>

<p id="status"></p>
<p id="attempts"></p>

<h3 id="answers"></h3>

<hr>

<div class="difficulty">
    <button onclick="setDifficulty('veryeasy')">Very Easy<br><small>min: 0</small></button>
    <button onclick="setDifficulty('easy')">Easy<br><small>min: 5001</small></button>
    <button onclick="setDifficulty('medium')">Medium<br><small>min: 10001</small></button>
    <button onclick="setDifficulty('hard')">Hard<br><small>min: 20001</small></button>
    <button onclick="setDifficulty('veryhard')">Very Hard<br><small>min: 30001</small></button>
    <button onclick="setDifficulty('impossible')">Impossible<br><small>min: 34001</small></button>
</div>

<p id="currentDiff"></p>

</div>

<script>
let words = [];
let currentSet = null;
let attemptsLeft = 2;

const difficulties = {
    veryeasy: { min: 0 },
    easy: { min: 5001 },
    medium: { min: 10001 },
    hard: { min: 20001 },
    veryhard: { min: 30001 },
    impossible: { min: 34001 }
};

let currentDifficulty = difficulties.veryeasy;

fetch("words.json?v=" + Date.now())
    .then(r => r.json())
    .then(data => {
        words = data;
        generatePuzzle();
    });

function setDifficulty(name) {
    currentDifficulty = difficulties[name];
    document.getElementById("currentDiff").textContent =
        `Difficulty: ${name.toUpperCase()} (min: ${currentDifficulty.min})`;
    generatePuzzle();
}

function generatePuzzle() {
    attemptsLeft = 2;
    document.getElementById("answers").textContent = "";
    document.getElementById("status").textContent = "";

    const grouped = {};

    for (const entry of words) {
        if (!grouped[entry.alphagram]) grouped[entry.alphagram] = [];
        grouped[entry.alphagram].push(entry);
    }

    const validSets = Object.values(grouped).filter(set => {
        const probs = set.map(w => w.probability);
        return Math.min(...probs) >= currentDifficulty.min;
    });

    if (validSets.length === 0) {
        document.getElementById("prompt").textContent = "No words in this difficulty ðŸ˜­";
        currentSet = null;
        return;
    }

    currentSet = validSets[Math.floor(Math.random() * validSets.length)];
    document.getElementById("prompt").textContent =
        `Guess a word for ${currentSet[0].alphagram}`;
    updateAttempts();
}

function submitGuess() {
    if (!currentSet || attemptsLeft <= 0) return;

    const guess = document.getElementById("guess").value.toUpperCase();
    document.getElementById("guess").value = "";

    if (currentSet.some(w => w.word === guess)) {
        document.getElementById("status").textContent = "Correct!";
        revealAnswers();
    } else {
        attemptsLeft--;
        updateAttempts();
        if (attemptsLeft <= 0) giveUp();
    }
}

function giveUp() {
    document.getElementById("status").textContent = "Out of tries.";
    revealAnswers();
}

function revealAnswers() {
    document.getElementById("answers").textContent =
        `Answers (${currentSet.length}): ` +
        currentSet.map(w => `${w.word} (prob: ${w.probability})`).join(", ");
}

function updateAttempts() {
    document.getElementById("attempts").textContent =
        `Attempts left: ${attemptsLeft}`;
}
</script>
</body>
</html>
